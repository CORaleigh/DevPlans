
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>Development Plan Lookup</title>

    <!-- Bootstrap core CSS -->
    <link href="../DevPlans/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../DevPlans/dist/css/stylesheet.css" rel="stylesheet">
    <link rel="shortcut icon" href="../DevPlans/dist/img/favicon.ico" />
    <link rel="icon" type="image/ico" href="../DevPlans/dist/img/favicon.ico" />


    <!-- Custom styles for this template -->
   

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" style="background-color:#5c8fea;" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" style="color:white;" href="../DevPlans/DevPlanSearch.html">Development Plan Lookup</a>
        </div>
        <div class="navbar-collapse collapse">
        </div><!--/.navbar-collapse -->
      </div>
    </div>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    
      <div class="container">
        <br><br>
      </div>
    

    <div class="container-fluid">
      <!-- Example row of columns -->
      
      <div class="row">
          <div class="col-md-9 col-md-offset-1">
            <div><br><br></div>
            <table id="datatable" class="table table-striped"></table>
          </div>
      </div>
     
      </div>

      <hr>

      <footer>
        <p id="spin">&copy; City of Raleigh 2014</p>
      </footer>
    </div> <!-- /container -->
    


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../DevPlans/dist/js/jquery-2.0.3.min.js"></script>
    <script src="../DevPlans/dist/js/bootstrap.min.js"></script>
    <script src="../DevPlans/dist/js/jquery.dataTables.js"></script>
    <script src="../DevPlans/dist/js/dataTablesBootstrap.js"></script>
    <script src="../DevPlans/dist/js/spin.min.js"></script>
    <!--<script src="../DevPlans
selection/dist/data/dp.js"></script>-->
   
    <script type="text/javascript" src="../DevPlans/dist/js/table.js">



//Spinner Options
var opts = {
  lines: 13, // The number of lines to draw
  length: 10, // The length of each line
  width: 10, // The line thickness
  radius: 20, // The radius of the inner circle
  corners: 1, // Corner roundness (0..1)
  rotate: 0, // The rotation offset
  direction: 1, // 1: clockwise, -1: counterclockwise
  color: '#6C8CD5', // #rgb or #rrggbb or array of colors
  speed: 1, // Rounds per second
  trail: 60, // Afterglow percentage
  shadow: false, // Whether to render a shadow
  hwaccel: false, // Whether to use hardware acceleration
  className: 'spinner', // The CSS class to assign to the spinner
  zIndex: 2e9, // The z-index (defaults to 2000000000)
  top: '100%', // Top position relative to parent
  left: '50%' // Left position relative to parent
};

//Target for loading spinner
var target = document.getElementById('spin');

var init = {
  items: [],
  start: 0,
  spinner: new Spinner(opts),
  url: function(count){
      var url = "http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/DataCollection/MapServer/2/query?where=OBJECTID+>+"+ count +"&outFields=*&f=pjson";
        $.getJSON(url , function( data ) {
          init.spinner.spin(target);

          console.log(data)
          for(each in data.features){
            var cal_year = data.features[each].attributes.CALENDEAR_YEAR;
            var descr = data.features[each].attributes.DESCRIPTION_OF_PLAN;
            var plnNum = data.features[each].attributes.PLAN_NUMBER;
            var numSh = data.features[each].attributes.NUMBER_OF_SHEETS;
            var projectOnFile = data.features[each].attributes.PROJECT_ON_FILE;
            var ptype = data.features[each].attributes.PLAN_TYPE;
            var pYear = data.features[each].attributes.PLAN_YEAR;
            var link = data.features[each].attributes.LINK;
            var pID = data.features[each].attributes.PLAN;
            var hyperlink = '//corpubw/Archives/DEVELOPMENT_PLANS/' + link;

            
            
            var date = new Date(cal_year);
            var d = date.getUTCDate();
            var m = date.getUTCMonth() + 1;
            var y = date.getUTCFullYear();
            var formatedDate = m + '/' + d + '/' + y;
            if (formatedDate == '1/1/1970'){
              formatedDate = null;
            }

            init.items.push([ptype, plnNum, pYear, formatedDate, pID, descr, numSh, '<a href=' + '"' + hyperlink + '"' + '>'+ pID + '</a>']);
           
          }
            //Recalls data if the response exceeds the max freatures returned
            if (data.features.length == 1000 ){
                init.start = init.start + 1000
                init.url(init.start);
            }
            //Runs after all data has been loading to the array, and creates table
            else {
              console.log('Data Finished Loading')
              createTable(init.items)
              init.spinner.stop();
            }

        });
        
      }
}

init.url(init.start);


function createTable(info){
  //Allows the table to be sorted by clicking on headings
  jQuery.fn.dataTableExt.oSort['string-case-asc']  = function(x,y) {
    return ((x < y) ? -1 : ((x > y) ?  1 : 0));
  };
 
  jQuery.fn.dataTableExt.oSort['string-case-desc'] = function(x,y) {
    return ((x < y) ?  1 : ((x > y) ? -1 : 0));
  };
  //Initiates the data table
  $(document).ready(function() {
    $('#datatable').dataTable({
              "sPaginationType": "bootstrap",
              "aaData": info,
              "bProcessing":true,
              "bDeferRender": true,
              "bRetrieve": true,
              "iDisplayLength": 5,
              "aLengthMenu": [5, 10, 15, 20],
              "aaSorting": [ [0,'asc'], [1,'asc'] ],
              "aoColumns": [
            { "sTitle": "PLAN TYPE" },
            { "sTitle": "PLAN #"},
            { "sTitle": "PLAN YEAR" },
            { "sTitle": "CALENDAR YEAR" },     
            { "sTitle": "PLAN", "sClass": "center" },
            { "sTitle": "DESCRIPITION", "sClass": "center" },
            { "sTitle": "# OF SHEETS", "sClass": "center"},
            { "sTitle": "Link TO FOLDER", "sClass": "center"}   
          ]
    });
  });
}


  

    </script>
  </body>
</html>
